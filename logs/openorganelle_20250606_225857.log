ğŸ”„ Processing arrays:   0%|          | 0/9 [00:00<?, ?arrays/s]ğŸ”„ Processing fibsem-int16/s8 (0.0MB):   0%|          | 0/9 [00:00<?, ?arrays/s]ğŸ”„ Processing fibsem-int16/s8 (0.0MB):   0%|          | 0/9 [00:00<?, ?arrays/s]ğŸš€ [MAIN] Starting OpenOrganelle Zarr Ingestion Pipeline
================================================================================
ğŸ“‹ Emergency Memory Management Mode: Ultra-Conservative Settings
================================================================================
â° Pipeline started at: 2025-06-07 02:59:03

ğŸ’¾ Initial memory usage: 69.5MB RSS
ğŸ”§ Emergency minimal settings: 2GB limit, 1 workers, 8MB chunks
âš ï¸  Large array filtering: Arrays > 500MB will be skipped to prevent SIGKILL
ğŸ”§ CPU optimization: Using 1 workers (detected 8 CPUs, max allowed: 1)
ğŸ”§ Dask configured: 8MB chunks, balanced performance and memory management
   ğŸ›¡ï¸ Memory limits: 40% target, 50% spill, 60% pause, 70% terminate
   âš¡ Multi-threaded processing with 1 workers for better CPU utilization

ğŸ”— [STEP 1/7] Connecting to S3 bucket: s3://janelia-cosem-datasets/jrc_mus-nacc-2/jrc_mus-nacc-2.zarr
   ğŸ“¡ Initializing S3 filesystem (anonymous access)...
   âœ… S3 connection established
   ğŸ“‹ Loading Zarr metadata...
   âš ï¸ Consolidated metadata not found, falling back to open_group: '.zmetadata'
   âœ… Loaded Zarr using standard metadata
   ğŸ“‚ Accessing internal path: recon-2/em
   âœ… Successfully accessed subgroup: recon-2/em
ğŸ” [STEP 2/7] Found 1 subgroup(s); starting metadata loading
   ğŸ“‹ Subgroups to process: ['fibsem-int16']
   ğŸ”§ Using 1 worker(s) for metadata loading
   ğŸ”„ Processing subgroup 1/1: fibsem-int16
      ğŸ” Scanning subgroup: fibsem-int16
      ğŸ“Š Found 9 arrays in fibsem-int16
         âœ… fibsem-int16/s0: (564, 2520, 2596) int16
         âœ… fibsem-int16/s1: (282, 1260, 1298) int16
         âœ… fibsem-int16/s2: (141, 630, 649) int16
         âœ… fibsem-int16/s3: (70, 315, 324) int16
         âœ… fibsem-int16/s4: (35, 157, 162) int16
         âœ… fibsem-int16/s5: (17, 78, 81) int16
         âœ… fibsem-int16/s6: (8, 39, 40) int16
         âœ… fibsem-int16/s7: (4, 19, 20) int16
         âœ… fibsem-int16/s8: (2, 9, 10) int16
   âœ… Completed fibsem-int16: 9 arrays loaded
ğŸ§© [STEP 2/7] âœ… Array discovery complete: 9 arrays in 2.59s
   ğŸ“Š Array inventory:
      â€¢ fibsem-int16/s0: (564, 2520, 2596) int16 (7037.4MB)
      â€¢ fibsem-int16/s1: (282, 1260, 1298) int16 (879.7MB)
      â€¢ fibsem-int16/s2: (141, 630, 649) int16 (110.0MB)
      â€¢ fibsem-int16/s3: (70, 315, 324) int16 (13.6MB)
      â€¢ fibsem-int16/s4: (35, 157, 162) int16 (1.7MB)
      â€¢ fibsem-int16/s5: (17, 78, 81) int16 (0.2MB)
      â€¢ fibsem-int16/s6: (8, 39, 40) int16 (0.0MB)
      â€¢ fibsem-int16/s7: (4, 19, 20) int16 (0.0MB)
      â€¢ fibsem-int16/s8: (2, 9, 10) int16 (0.0MB)

ğŸ“ [STEP 3/7] Setting up output directory: /app/data/openorganelle
   âœ… Output directory ready, timestamp: 20250607_025906

ğŸ” [STEP 4/7] Analyzing arrays and filtering by size
   ğŸ“Š Calculating memory requirements for 9 arrays...
       1/9 fibsem-int16/s0: 7037.4MB
       2/9 fibsem-int16/s1: 879.7MB
       3/9 fibsem-int16/s2: 110.0MB
       4/9 fibsem-int16/s3: 13.6MB
       5/9 fibsem-int16/s4: 1.7MB
       6/9 fibsem-int16/s5: 0.2MB
       7/9 fibsem-int16/s6: 0.0MB
       8/9 fibsem-int16/s7: 0.0MB
       9/9 fibsem-int16/s8: 0.0MB
   âœ… Memory analysis complete
   ğŸ›¡ï¸ Applying large array strategy: stream (max 500MB per array)
   ğŸ”§ SPECIAL PROCESSING for 2 large arrays (7917.1MB total):
      ğŸ“‹ Mode: stream
      ğŸ¯ fibsem-int16/s0 (7037.4MB) - will use stream processing
      ğŸ¯ fibsem-int16/s1 (879.7MB) - will use stream processing
   ğŸ“ˆ Sorting 7 processable arrays by size...
   ğŸ“‹ Categorizing arrays by size:
      ğŸŸ¢ Small (<25MB): 6 arrays
      ğŸŸ¡ Medium (25-100MB): 0 arrays
      ğŸ”´ Large (â‰¥100MB): 1 arrays
ğŸ“Š Found 7 processable arrays, total estimated size: 125.5MB
   ğŸ“‹ Categories: 6 small (<25MB), 0 medium (25-100MB), 1 large (â‰¥100MB)

ğŸ“‹ Processable array size breakdown:
   1. ğŸŸ¢ fibsem-int16/s8           0.0MB
   2. ğŸŸ¢ fibsem-int16/s7           0.0MB
   3. ğŸŸ¢ fibsem-int16/s6           0.0MB
   4. ğŸŸ¢ fibsem-int16/s5           0.2MB
   5. ğŸŸ¢ fibsem-int16/s4           1.7MB
   6. ğŸŸ¢ fibsem-int16/s3          13.6MB
   7. ğŸ”´ fibsem-int16/s2         110.0MB

ğŸ”§ Emergency minimal processing strategy: 1 worker, 8MB chunks
   ğŸ›¡ï¸ Strategy: Sequential processing only to prevent SIGKILL
   ğŸ“‰ Arrays >500MB are skipped to stay within 2GB memory limit
   âš¡ Large array optimization: Will process 1 large arrays with adaptive chunking
   ğŸš€ Small array batch processing: Will process 6 small arrays in parallel

ğŸš€ [STEP 5/7] Starting array processing pipeline
   ğŸ“‹ Processing strategy: Emergency sequential mode
   ğŸ›¡ï¸ Memory budget: 2GB container limit
   âš™ï¸  Settings: 1 worker, 8MB chunks, synchronous Dask
   ğŸ“‹ Will process 2 large arrays using stream mode

ğŸ“Š [STEP 6/7] Processing 9 arrays sequentially
================================================================================
ğŸ”„ Processing fibsem-int16/s8 (0.0MB):  11%|â–ˆ         | 1/9 [00:00<00:01,  5.47arrays/s]ğŸ”„ Processing fibsem-int16/s8 (0.0MB):  11%|â–ˆ         | 1/9 [00:00<00:01,  5.47arrays/s]ğŸ”„ Processing fibsem-int16/s7 (0.0MB):  11%|â–ˆ         | 1/9 [00:00<00:01,  5.47arrays/s]ğŸ”„ Processing fibsem-int16/s7 (0.0MB):  11%|â–ˆ         | 1/9 [00:00<00:01,  5.47arrays/s]ğŸ”„ Processing fibsem-int16/s7 (0.0MB):  22%|â–ˆâ–ˆâ–       | 2/9 [00:00<00:01,  3.92arrays/s]ğŸ”„ Processing fibsem-int16/s7 (0.0MB):  22%|â–ˆâ–ˆâ–       | 2/9 [00:00<00:01,  3.92arrays/s]ğŸ”„ Processing fibsem-int16/s6 (0.0MB):  22%|â–ˆâ–ˆâ–       | 2/9 [00:00<00:01,  3.92arrays/s]ğŸ”„ Processing fibsem-int16/s6 (0.0MB):  22%|â–ˆâ–ˆâ–       | 2/9 [00:00<00:01,  3.92arrays/s]ğŸ”„ Processing fibsem-int16/s6 (0.0MB):  33%|â–ˆâ–ˆâ–ˆâ–      | 3/9 [00:00<00:01,  3.56arrays/s]ğŸ”„ Processing fibsem-int16/s6 (0.0MB):  33%|â–ˆâ–ˆâ–ˆâ–      | 3/9 [00:00<00:01,  3.56arrays/s]ğŸ”„ Processing fibsem-int16/s5 (0.2MB):  33%|â–ˆâ–ˆâ–ˆâ–      | 3/9 [00:00<00:01,  3.56arrays/s]ğŸ”„ Processing fibsem-int16/s5 (0.2MB):  33%|â–ˆâ–ˆâ–ˆâ–      | 3/9 [00:00<00:01,  3.56arrays/s]ğŸ”„ Processing fibsem-int16/s5 (0.2MB):  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 4/9 [00:01<00:02,  2.12arrays/s]ğŸ”„ Processing fibsem-int16/s5 (0.2MB):  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 4/9 [00:01<00:02,  2.12arrays/s]ğŸ”„ Processing fibsem-int16/s4 (1.7MB):  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 4/9 [00:01<00:02,  2.12arrays/s]ğŸ”„ Processing fibsem-int16/s4 (1.7MB):  44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 4/9 [00:01<00:02,  2.12arrays/s]ğŸ”„ Processing fibsem-int16/s4 (1.7MB):  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 5/9 [00:02<00:03,  1.23arrays/s]ğŸ”„ Processing fibsem-int16/s4 (1.7MB):  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 5/9 [00:02<00:03,  1.23arrays/s]ğŸ”„ Processing fibsem-int16/s3 (13.6MB):  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 5/9 [00:03<00:03,  1.23arrays/s]ğŸ”„ Processing fibsem-int16/s3 (13.6MB):  56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 5/9 [00:03<00:03,  1.23arrays/s]ğŸ”„ Processing fibsem-int16/s3 (13.6MB):  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 6/9 [00:10<00:09,  3.23s/arrays]ğŸ”„ Processing fibsem-int16/s3 (13.6MB):  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 6/9 [00:10<00:09,  3.23s/arrays]ğŸ”„ Processing fibsem-int16/s2 (110.0MB):  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 6/9 [00:11<00:09,  3.23s/arrays]ğŸ”„ Processing fibsem-int16/s2 (110.0MB):  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 6/9 [00:11<00:09,  3.23s/arrays]ğŸ”„ Processing fibsem-int16/s2 (110.0MB):  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 7/9 [01:01<00:37, 18.58s/arrays]ğŸ”„ Processing fibsem-int16/s2 (110.0MB):  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 7/9 [01:01<00:37, 18.58s/arrays]ğŸ”„ Processing fibsem-int16/s0 (7037.4MB):  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 7/9 [01:01<00:37, 18.58s/arrays]ğŸ”„ Processing fibsem-int16/s0 (7037.4MB):  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 7/9 [01:01<00:37, 18.58s/arrays]ğŸŒŠ Streaming fibsem-int16_s0:   0%|          | 0/5 [00:00<?]ğŸŒŠ fibsem-int16_s0: Writing metadata stub:   0%|          | 0/5 [00:00<?]
ğŸ”„ Processing array 1/9: fibsem-int16/s8 (0.0MB)
  ğŸ’¾ Processing fibsem-int16/s8: estimated 0.0MB (current memory: 85.0MB)
  ğŸ“Š Array: 0.0MB, target chunk: 8MB, current RSS: 85.0MB
  ğŸ”„ Computing entire array (0.0MB) - very small
  ğŸ’¿ Saving volume to disk (0.0MB)
âœ… [1/9] ğŸŸ¢ fibsem-int16/s8 completed in 0.2s
   ğŸ“Š Result: ğŸŸ¢ fibsem-int16/s8 saved in 0.0s (0.0MB @ 0.0 MB/s)

ğŸ”„ Processing array 2/9: fibsem-int16/s7 (0.0MB)
   â±ï¸  Progress: 1/9 | Avg: 0.3s/array | ETA: 2s
  ğŸ’¾ Processing fibsem-int16/s7: estimated 0.0MB (current memory: 85.1MB)
  ğŸ“Š Array: 0.0MB, target chunk: 8MB, current RSS: 85.1MB
  ğŸ”„ Computing entire array (0.0MB) - very small
  ğŸ’¿ Saving volume to disk (0.0MB)
âœ… [2/9] ğŸŸ¢ fibsem-int16/s7 completed in 0.2s
   ğŸ“Š Result: ğŸŸ¢ fibsem-int16/s7 saved in 0.0s (0.0MB @ 0.1 MB/s)

ğŸ”„ Processing array 3/9: fibsem-int16/s6 (0.0MB)
   â±ï¸  Progress: 2/9 | Avg: 0.3s/array | ETA: 2s
  ğŸ’¾ Processing fibsem-int16/s6: estimated 0.0MB (current memory: 85.2MB)
  ğŸ“Š Array: 0.0MB, target chunk: 8MB, current RSS: 85.2MB
  ğŸ”„ Computing entire array (0.0MB) - very small
  ğŸ’¿ Saving volume to disk (0.0MB)
âœ… [3/9] ğŸŸ¢ fibsem-int16/s6 completed in 0.2s
   ğŸ“Š Result: ğŸŸ¢ fibsem-int16/s6 saved in 0.1s (0.0MB @ 0.4 MB/s)

ğŸ”„ Processing array 4/9: fibsem-int16/s5 (0.2MB)
   â±ï¸  Progress: 3/9 | Avg: 0.3s/array | ETA: 2s
  ğŸ’¾ Processing fibsem-int16/s5: estimated 0.2MB (current memory: 85.3MB)
  ğŸ“Š Array: 0.2MB, target chunk: 8MB, current RSS: 85.3MB
  ğŸ”„ Computing entire array (0.2MB) - very small
  ğŸ’¿ Saving volume to disk (0.2MB)
âœ… [4/9] ğŸŸ¢ fibsem-int16/s5 completed in 0.6s
   ğŸ“Š Result: ğŸŸ¢ fibsem-int16/s5 saved in 0.3s (0.2MB @ 0.8 MB/s)

ğŸ”„ Processing array 5/9: fibsem-int16/s4 (1.7MB)
   â±ï¸  Progress: 4/9 | Avg: 0.4s/array | ETA: 2s
  ğŸ’¾ Processing fibsem-int16/s4: estimated 1.7MB (current memory: 86.2MB)
  ğŸ“Š Array: 1.7MB, target chunk: 8MB, current RSS: 86.2MB
  ğŸ”„ Computing entire array (1.7MB) - very small
  ğŸ’¿ Saving volume to disk (1.7MB)
âœ… [5/9] ğŸŸ¢ fibsem-int16/s4 completed in 1.3s
   ğŸ“Š Result: ğŸŸ¢ fibsem-int16/s4 saved in 0.8s (1.7MB @ 2.0 MB/s)
   ğŸ“ˆ Progress Summary: 5/9 arrays | 1.67 arrays/min | Memory: 87MB

ğŸ”„ Processing array 6/9: fibsem-int16/s3 (13.6MB)
   â±ï¸  Progress: 5/9 | Avg: 0.6s/array | ETA: 3s
  ğŸ’¾ Processing fibsem-int16/s3: estimated 13.6MB (current memory: 86.8MB)
  ğŸ“Š Array: 13.6MB, target chunk: 8MB, current RSS: 86.8MB
  ğŸ§© Using conservative chunking strategy (13.6MB)
  âš¡ Rechunking from (64, 64, 64) to [64, 39, 40]
     Creating 162 chunks for optimized processing
  ğŸ”„ Computing with 2 x 9 x 9 = 162 chunks...
  ğŸŸ¢ Small array (13.6MB), quick processing...
     ğŸ”§ Computing with 1 workers for better CPU utilization
     ğŸ” Pre-compute memory: 86.8MB
  âœ… Small array computation complete in 4.8s
  ğŸ’¿ Saving volume to disk (13.6MB)
âœ… [6/9] ğŸŸ¢ fibsem-int16/s3 completed in 7.7s
   ğŸ“Š Result: ğŸŸ¢ fibsem-int16/s3 saved in 4.9s (13.6MB @ 2.8 MB/s)

ğŸ”„ Processing array 7/9: fibsem-int16/s2 (110.0MB)
   â±ï¸  Progress: 6/9 | Avg: 1.8s/array | ETA: 6s
  ğŸ’¾ Processing fibsem-int16/s2: estimated 110.0MB (current memory: 91.5MB)
  ğŸ¯ Large array processing: fibsem-int16/s2 (110.0MB)
     â° Started at: 02:59:17
  ğŸ“Š Array: 110.0MB, target chunk: 8MB, current RSS: 91.5MB
  ğŸ§© Using conservative chunking strategy (110.0MB)
  âš¡ Rechunking from (64, 64, 64) to [32, 64, 64]
     Creating 550 chunks for optimized processing
  ğŸ”„ Computing with 5 x 10 x 11 = 550 chunks...
  â±ï¸ Large array detected (110.0MB), processing with emergency settings...
     ğŸ“Š Array shape: (141, 630, 649), dtype: int16
     ğŸ§© Processing 550 chunks sequentially (emergency mode)
     ğŸ›¡ï¸ Memory-safe processing with 8MB chunks
  ğŸ”„ Starting computation at 02:59:17...
     ğŸ”§ Computing with 1 workers for better CPU utilization
     ğŸ” Pre-compute memory: 91.5MB
  âœ… Large array computation complete in 33.2s (3.3 MB/s)
     ğŸ“ˆ Final memory: 200.1MB RSS, avg CPU: 0.0%
     ğŸ›¡ï¸ Emergency mode successful - no SIGKILL
     âœ… Good memory usage (9.8%) - emergency settings working
  â° Completed at: 02:59:50 (33.3s, 3.3 MB/s)
  ğŸ’¿ Saving volume to disk (110.0MB)
âœ… [7/9] ğŸ”´ fibsem-int16/s2 completed in 50.0s
   ğŸ“Š Result: ğŸŸ¡ fibsem-int16/s2 saved in 33.3s (110.0MB @ 3.3 MB/s)

ğŸ”„ Processing array 8/9: fibsem-int16/s0 (7037.4MB)
   â±ï¸  Progress: 7/9 | Avg: 8.7s/array | ETA: 17s
   ğŸ¯ Large array detected: using stream processing
  ğŸ’¾ Streaming large array fibsem-int16/s0: estimated 7037.4MB (current memory: 90.6MB)
ğŸŒŠ fibsem-int16_s0: Calculating streaming chunks:  20%|â–ˆâ–ˆ        | 1/5 [00:00<00:00]
     ğŸ”„ Rechunking array:   0%|          | [00:00][A  ğŸ”„ Streaming processing: chunk-by-chunk to avoid memory limits
     ğŸ§© Rechunking to optimized streaming chunks: [17, 78, 81]
     âš¡ Expected parallelism: ~37026 chunks across 8 CPUs

     ğŸ”„ Rechunking array: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| [00:02][A
                                                  [AğŸŒŠ fibsem-int16_s0: Calculating streaming chunks:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 2/5 [00:02<00:04]ğŸŒŠ fibsem-int16_s0: Streaming to Zarr format:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 2/5 [00:02<00:04]      ğŸ’¿ Streaming to Zarr format: /app/data/openorganelle/fibsem-int16_s0_20250607_025906.zarr
     ğŸ’¾ Created Zarr store: /app/data/openorganelle/fibsem-int16_s0_20250607_025906.zarr
     ğŸ“ˆ Calculated streaming: 3,689,642,880 elements in 34,352 chunks
     ğŸ“Š Chunk details: [17, 78, 81] = 107,406 elements per chunk
     ğŸ”§ Using 4 workers for streaming (detected 8 CPUs)
     ğŸ’¿ Streaming 34352 chunks to Zarr with 4 workers...
     âš¡ Computing and writing chunks with 4 workers...

     ğŸ’¿ Writing Zarr chunks: 0/34352 chunks |          | [00:00<?, ?chunks/s][A
